{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="left-panel">
        <div class="logo-section">
            <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="greenFeather" class="logo">
            <span class="logo-text">greenFeather</span>
        </div>
        <div class="form-container">
            <div class="login-header">
                <h1>Reset Password</h1>
                <p>Enter your email to receive password reset instructions.</p>
            </div>

            <form class="login-form" id="resetForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <div class="input-group">
                        <img src="{{ url_for('static', filename='img/email.svg') }}" alt="Email" class="input-icon">
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Send Reset Link</button>

                <div class="bottom-text">
                    Remember your password? <a href="{{ url_for('index') }}" class="link">Sign in</a>
                </div>
            </form>
        </div>
    </div>
    <div class="right-panel">
        <div class="illustration">
            <img src="{{ url_for('static', filename='img/login-illustration.svg') }}" alt="Reset Password illustration">
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const resetForm = document.getElementById('resetForm');

    resetForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;

        try {
            const response = await fetch('/api/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email })
            });

            const data = await response.json();
            
            // Create flash message
            const flashMessage = document.createElement('div');
            flashMessage.textContent = data.message;
            flashMessage.className = `flash-message ${response.ok ? 'success' : 'error'}`;
            document.body.appendChild(flashMessage);

            if (response.ok) {
                resetForm.reset();
            }

            setTimeout(() => flashMessage.remove(), 5000);
        } catch (error) {
            console.error('Reset password error:', error);
            const flashMessage = document.createElement('div');
            flashMessage.textContent = 'An error occurred. Please try again later.';
            flashMessage.className = 'flash-message error';
            document.body.appendChild(flashMessage);
            setTimeout(() => flashMessage.remove(), 5000);
        }
    });
});
</script>
{% endblock %}
